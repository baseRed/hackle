回调函数 VS 系统调用栈

什么是回调函数
将一个函数作为参数传递给另外一个函数，那作为参数的这个函数就是回调函数

当循环系统在执行一个任务的时候，都要为这个任务维护一个系统调用栈。这个系统调用栈类似于 JavaScript 的调用栈，只
不过系统调用栈是 Chromium 的开发语言 C++ 来维护的

异步回调是指回调函数在主函数之外执行，一般有两种方式：

第一种是把异步函数做成一个任务，添加到信息队列尾部；
第二种是把异步函数添加到微任务队列中，这样就可以在当前任务的末尾处执行微任务了。

XMLHttpRequest 运作机制

创建 XMLHttpRequest 对象。
当执行到let xhr = new XMLHttpRequest()后，JavaScript 会创建一个 XMLHttpRequest 对象xhr，用来执行实际的网络请求操作

为 xhr 对象注册回调函数
因为网络请求比较耗时，所以要注册回调函数，这样后台任务执行完成之后就会通过调用回调函数来告诉其执行结果。

XMLHttpRequest 的回调函数主要有下面几种：

ontimeout，用来监控超时请求，如果后台请求超时了，该函数会被调用；
onerror，用来监控出错信息，如果后台请求出错了，该函数会被调用；
onreadystatechange，用来监控后台请求过程中的状态，比如可以监控到 HTTP 头加载完成的消息、HTTP 响应体消息
以及数据加载完成的消息等。

配置基础的请求信息。
注册好回调事件之后，接下来就需要配置基础的请求信息了，首先要通过 open 接口配置一些基础的请求信息，包括请求的地址、
请求方法（是 get 还是 post）和请求方式（同步还是异步请求）。
xhr.timeout = 3000来配置超时时间
xhr.responseType = "text"来配置服务器返回的格式，将服务器返回的数据自动转换为自己想要的格式，如果将 responseType 
的值设置为 json，那么系统会自动将服务器返回的数据转换为 JavaScript 对象格式

发起请求
准备就绪之后，就可以调用xhr.send来发起网络请求了
渲染进程会将请求发送给网络进程，然后网络进程负责资源的下载，等网络进程接收到数据之后，就会利用 IPC 来通知渲染进程；
渲染进程接收到消息之后，会将 xhr 的回调函数封装成任务并添加到消息队列中，等主线程循环系统执行到该任务的时候，就会
根据相关的状态来调用对应的回调函数。

XMLHttpRequest 使用过程中的“坑”

跨域问题

HTTPS 混合内容的问题
HTTPS 混合内容是 HTTPS 页面中包含了不符合 HTTPS 安全要求的内容，比如包含了 HTTP 资源，通过 HTTP 加载的图像、
视频、样式表、脚本等，都属于混合内容
通过 HTML 文件加载的混合资源，虽然给出警告，但大部分类型还是能加载的。而使用 XMLHttpRequest 请求时，浏览器认为这
种请求可能是攻击者发起的，会阻止此类危险的请求
